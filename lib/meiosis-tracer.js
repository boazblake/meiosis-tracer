module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";var n=r(1);e.exports=n.meiosisTracer},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.meiosisTracer=void 0;var n=r(2),a=r(3),i=r(4);function d(e){if(!e.update||!e.dataStreams)throw new Error("Please specify update and dataStreams.");if(window&&window.__MEIOSIS_TRACER_GLOBAL_HOOK__){var t=e.toJS||function(e){return JSON.parse(JSON.stringify(e))},r=e.fromJS||function(e){return e},n=e.toUpdate||function(e){return function(){return e}},a=[],i=[],d=!1,o=!0,u=!0,c=e.dataStreams[e.dataStreams.length-1],s=[],l={};e.otherStreams&&e.otherStreams.length&&e.otherStreams.forEach(function(e){var t="stream_"+(new Date).getTime();s.push(t),l[t]=e,e.map(function(e){var r={type:"MEIOSIS_STREAM_VALUE",value:e,streamId:t};d?window.postMessage(r,"*"):i.push(r)})}),window.addEventListener("message",function(t){if("MEIOSIS_RENDER_MODEL"===t.data.type)o=t.data.sendValuesBack,u=!1,e.update(n(r(t.data.model)));else if("MEIOSIS_TRACER_INIT"===t.data.type)d=!0,s.length>0&&window.postMessage({type:"MEIOSIS_STREAM_IDS",streamIds:s},"*"),a.forEach(function(e){return window.postMessage({type:"MEIOSIS_VALUES",values:e,update:!0},"*")}),i.forEach(function(e){return window.postMessage(e,"*")});else if("MEIOSIS_TRIGGER_STREAM_VALUE"===t.data.type){var c=t.data.streamId,m=t.data.value;l[c](m)}}),c.map(function(){if(o||u){var r=e.dataStreams.map(function(e){return{value:t(e())}});d?window.postMessage({type:"MEIOSIS_VALUES",values:r,update:!0},"*"):a.push(r)}u=!0}),window.postMessage({type:"MEIOSIS_PING"},"*")}}window.__MEIOSIS_TRACER_GLOBAL_HOOK__=!0;t.meiosisTracer=function(e){d(e);var t=e.selector,r=e.renderModel,o=e.triggerStreamValue,u=e.horizontal,c=e.rows,s=e.cols;if(document.querySelector(t)){var l=!0,m=(0,i.createReceiveValues)(n.tracerModel,(0,a.createTracerView)(function(e){l=e}));r=r||function(e,t){return window.postMessage({type:"MEIOSIS_RENDER_MODEL",model:e,sendValuesBack:t},"*")},(0,a.initialView)(t,n.tracerModel,r,u,c,s),o=o||function(e,t){return window.postMessage({type:"MEIOSIS_TRIGGER_STREAM_VALUE",streamId:e,value:t},"*")};var v=function(e){e.forEach(function(e){return n.tracerModel.streams[e]={index:0,values:[]}}),(0,a.initStreamIds)(e,n.tracerModel.streams,o,c,s)},S=function(e,t){var r=n.tracerModel.streams[e];r.values.push(t),r.index=r.values.length-1,(0,a.updateStreamValue)(e,r)};return window.addEventListener("message",function(e){if("MEIOSIS_VALUES"===e.data.type)m(e.data.values,l&&e.data.update);else if("MEIOSIS_STREAM_IDS"===e.data.type){var t=e.data.streamIds;v(t)}else"MEIOSIS_STREAM_VALUE"===e.data.type&&S(e.data.streamId,e.data.value)}),window.postMessage({type:"MEIOSIS_TRACER_INIT"},"*"),{receiveValues:m,initStreamIdModel:v,receiveStreamValue:S,reset:function(){return(0,a.reset)(n.tracerModel)}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.tracerModel={tracerStates:[],tracerIndex:0,streams:{}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=null,a=null,i=0,d=0,o=null,u=!0,c=function(e,t){var r=document.getElementById("tracerSlider");if(r.setAttribute("max",String(t.tracerStates.length-1)),r.value=String(t.tracerIndex),document.getElementById("tracerStepBack").disabled=0===t.tracerIndex,document.getElementById("tracerStepForward").disabled=t.tracerIndex===t.tracerStates.length-1,document.getElementById("tracerIndex").innerHTML=String(t.tracerIndex),document.getElementById("tracerModel").value=JSON.stringify(e[0].value,null,4),0===document.querySelectorAll("div.dataStream").length){for(var n="",o=1,u=e.length;o<u;o++)n+="<div"+a+" class='dataStream'><textarea rows='"+i+"' cols='"+d+"'></textarea></div>";document.getElementById("dataStreamContainer").innerHTML=n}var c=document.querySelectorAll("div.dataStream textarea");for(o=1,u=e.length;o<u;o++)c[o-1].value=JSON.stringify(e[o].value,null,4)},s=function(e,t){return function(r){var n=parseInt(r.target.value,10),a=t.tracerStates[n];t.tracerIndex=n;var i=a[0].value;e(i,!1),c(a,t)}},l=function(e){var t=e.tracerStates[0];e.tracerStates.length=0,e.tracerIndex=0,c(t,e)},m=function(e,t){var r=document.getElementById(e),n=r.getElementsByTagName("textarea")[0],a=r.getElementsByTagName("input")[0],i=r.getElementsByTagName("div")[0];n.value=JSON.stringify(t.values[t.index],null,4),a.setAttribute("max",String(t.values.length-1)),a.value=String(t.index),i.innerHTML=String(t.index)};t.initialView=function(e,t,r,c){var m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,v=arguments.length>5&&void 0!==arguments[5]?arguments[5]:40,S=document.querySelector(e);if(i=m,d=v,S){a=c?" style='float: left'":"";var f="<div style='text-align: right'><button id='tracerToggle'>Hide</button></div><div id='tracerContainer'><div style='text-align: right'><button id='tracerReset'>Reset</button></div><div>Data streams:</div><input id='tracerSlider' type='range' min='0' max='"+String(t.tracerStates.length-1)+"' value='"+String(t.tracerIndex)+"' style='width: 100%'/><button id='tracerStepBack'>&lt</button> <button id='tracerStepForward'>&gt</button> <span id='tracerIndex'>"+String(t.tracerIndex)+"</span><label><input style='margin-left: 16px' type='checkbox' id='tracerAccumulHistory' checked/>Accumulate history</label><div"+a+"><div><span>Model: (type into this box) </span><button style='margin-bottom: 4px' id='tracerRefreshView'>Refresh view</button></div><textarea id='tracerModel' rows='"+i+"' cols='"+d+"'></textarea><div id='errorMessage' style='display: none'><span style='color:red'>Invalid JSON</span></div></div><span id='dataStreamContainer'></span><span id='otherStreamContainer'></span></div>";S.innerHTML=f;var g=document.getElementById("tracerContainer");n=document.getElementById("errorMessage"),document.getElementById("tracerSlider").addEventListener("input",s(r,t)),document.getElementById("tracerToggle").addEventListener("click",function(e){return function(t){var r=t.target;"none"===e.style.display?(e.style.display="block",r.innerHTML="Hide"):(e.style.display="none",r.innerHTML="Show")}}(g)),document.getElementById("tracerReset").addEventListener("click",function(e){return function(){l(e)}}(t)),document.getElementById("tracerStepBack").addEventListener("click",function(){s(r,t)({target:{value:Math.max(0,t.tracerIndex-1)}})}),document.getElementById("tracerStepForward").addEventListener("click",function(){s(r,t)({target:{value:Math.min(t.tracerStates.length-1,t.tracerIndex+1)}})}),document.getElementById("tracerRefreshView").addEventListener("click",function(){!function(e){try{var t=document.getElementById("tracerModel").value;e(JSON.parse(t),!0),n.style.display="none"}catch(e){n.style.display="block"}}(r)}),document.getElementById("tracerAccumulHistory").addEventListener("change",function(){o(u=!u)})}},t.createTracerView=function(e){return o=e,c},t.reset=l,t.initStreamIds=function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:40,o="<div>Other streams:</div>";e.forEach(function(e){return o+="<div"+a+" class='otherStream' id='"+e+"'><input type='range' min='0' max='0' value='0' style='width: 100%'/><div>0</div><textarea rows='"+i+"' cols='"+d+"'></textarea><div><button>Trigger</button></div></div>"}),document.getElementById("otherStreamContainer").innerHTML=o,e.forEach(function(e){var a=document.getElementById(e);a.getElementsByTagName("input")[0].addEventListener("input",function(e,t){return function(r){var n=e[t],a=parseInt(r.target.value,10);n.index=a,m(t,n)}}(t,e));var i=a.getElementsByTagName("button")[0],d=a.getElementsByTagName("textarea")[0];i.addEventListener("click",function(e,t,r){return function(){try{var a=JSON.parse(t.value);r(e,a),n.style.display="none"}catch(e){n.style.display="block"}}}(e,d,r))})},t.updateStreamValue=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.createReceiveValues=function(e,t){return function(r,n){n&&(e.tracerStates.length>0&&(e.tracerStates.length=e.tracerIndex+1),e.tracerStates.push(r),e.tracerIndex=e.tracerStates.length-1),t(r,e)}}}]);
//# sourceMappingURL=meiosis-tracer.js.map